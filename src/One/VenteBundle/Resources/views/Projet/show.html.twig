<div class="row task-bar">
    <div class="col-md-1">
        <span class="glyphicon glyphicon-menu-left btn-back" onclick="initAllFilter(); loadListProjet();"></span>
    </div>
    <div class="col-md-8">
        <h2 class="heading">Projet {{ projet.nom }}</h2>
    </div>
    <div class="col-md-3">
        <div class="pull-right">
            <div class="btn-group">
                <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Nouvelle action <span class="glyphicon glyphicon-menu-down"></span>
                </button>
                <ul class="dropdown-menu pull-right">
                    <li><a onclick="loadNewTache();">Nouvelle Tâche</a></li>
                    <li><a onclick="loadNewAppel();">Nouveau A faire</a></li>
                    <li><a onclick="loadNewFacture();">Nouvelle Facture Client</a></li>
                    <li><a onclick="loadNewEncaissement();">Nouvel Encaissement de Vente</a></li>
                    <li><a onclick="loadNewAvoir();">Nouvel Avoir Client</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-3">
        <div class="bloc-detail-infos">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="pull-left">Informations</h3>
                    <span onclick="loadEditProjet({{ projet.id }});" class="edit-action glyphicon glyphicon-pencil pull-right" aria-hidden="true"></span>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 item">
                    <span>Profit:</span>
                </div>
                <div class="col-md-12 item">
                    <span>Revenu:</span>
                </div>
                <div class="col-md-12 item">
                    <span>Coût:</span>
                </div>
            </div>
        </div>
    </div>
    {% if taches|length > 0 or appels|length > 0 or factures|length > 0 or encaissements|length > 0 or avoirs|length > 0 or type != 'all' %}
    <div class="col-md-9">
        <div class="row">
            <div class="col-md-12">
                <ul class="type-filter-bar">
                    {% set nbactivites = taches|length + appels|length + factures|length + encaissements|length + avoirs|length %}
                    <li{% if type == 'all' %} class="active"{% endif %}>
                        <a onclick="setFilterType('all'); updateView('bloc'); setPeriod('all'); initSearchInProjet({{ projet.id }});">Activité <i>{{ nbactivites }}</i></a>
                    </li>
                    {% if appels|length > 0 %}
                        <li{% if type == 'appel' %} class="active"{% endif %}>
                            <a onclick="setFilterType('appel'); setPeriod('all'); initSearchInProjet({{ projet.id }});">A faire <i>{{ appels|length }}</i></a>
                        </li>
                    {% endif %}
                    {% if taches|length > 0 %}
                        <li{% if type == 'tache' %} class="active"{% endif %}>
                            <a onclick="setFilterType('tache'); setPeriod('all'); initSearchInProjet({{ projet.id }});">Tâche pour Opportunité <i>{{ taches|length }}</i></a>
                        </li>
                    {% endif %}
                    {% if factures|length > 0 %}
                        <li{% if type == 'facture' %} class="active"{% endif %}>
                            <a onclick="setFilterType('facture'); setPeriod('all'); initSearchInProjet({{ projet.id }});">Facture <i>{{ factures|length }}</i></a>
                        </li>
                    {% endif %}
                    {% if encaissements|length > 0 %}
                        <li{% if type == 'encaissement' %} class="active"{% endif %}>
                            <a onclick="setFilterType('encaissement'); setPeriod('all'); initSearchInProjet({{ projet.id }});">Encaissements de Vente <i>{{ encaissements|length }}</i></a>
                        </li>
                    {% endif %}
                    {% if avoirs|length > 0 %}
                        <li{% if type == 'avoir' %} class="active"{% endif %}>
                            <a onclick="setFilterType('avoir'); setPeriod('all'); initSearchInProjet({{ projet.id }});">Avoir <i>{{ avoirs|length }}</i></a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="details-filter-bar">
                    <div class="row">
                        {% if type == 'all' %}
                        <div class="col-md-12 col-sm-12 col-xs-12">
                        {% else %}
                        <div class="col-md-6 col-sm-12 col-xs-12">
                        {% endif %}
                            <div class="input-group">
                                <span class="input-group-addon btn-search" onclick="searchInProjet({{ projet.id }});">
                                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                </span>
                                {% if type == 'all' %}{% set placeholder = 'Recherche' %}{% endif %}
                                {% if type == 'appel' %}{% set placeholder = 'Recherche dans A faire' %}{% endif %}
                                {% if type == 'tache' %}{% set placeholder = 'Recherche dans Tâches pour Opportunité' %}{% endif %}
                                {% if type == 'facture' %}{% set placeholder = 'Recherche dans Factures' %}{% endif %}
                                {% if type == 'encaissement' %}{% set placeholder = 'Recherche dans Encaissements' %}{% endif %}
                                {% if type == 'avoir' %}{% set placeholder = 'Recherche dans Avoirs' %}{% endif %}
                                <input type="text" class="form-control search" name="search" value="{{ q }}" placeholder="{{ placeholder }}">
                                <span class="glyphicon glyphicon-remove hidden init-search" aria-hidden="true" onclick="initSearchInProjet({{ projet.id }});"></span>
                            </div>
                        </div>
                        {% if type != 'all' %}
                        <div class="col-md-5 col-sm-12 col-xs-12">
                            <div class="dropdown pull-right sort-date">
                                {% if period == 'today' %}{% set sortdate = "Aujourd'hui" %}
                                {% elseif period == 'lastweek' %}{% set sortdate = 'Semaine dernière' %}
                                {% elseif period == 'thisweek' %}{% set sortdate = 'Cette semaine' %}
                                {% elseif period == 'nextweek' %}{% set sortdate = 'Semaine prochaine' %}
                                {% elseif period == 'lastmonth' %}{% set sortdate = 'Mois dernier' %}
                                {% elseif period == 'thismonth' %}{% set sortdate = 'Ce mois' %}
                                {% elseif period == 'nextmonth' %}{% set sortdate = 'Mois prochain' %}
                                {% elseif period == 'lastyear' %}{% set sortdate = 'Année dernière' %}
                                {% elseif period == 'thisyear' %}{% set sortdate = 'Cette année' %}
                                {% elseif period == 'custom' %}{% set sortdate = startperiod ~' - '~ endperiod %}
                                {% else %}{% set sortdate = 'Toutes les dates' %}
                                {% endif %}
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-calendar"></span> {{ sortdate }} <span class="glyphicon glyphicon-menu-down"></span></a>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li class="date-field">
                                        <input type="text" class="form-control datepicker startdate" value="{{ startperiod }}">
                                        <input type="text" class="form-control datepicker enddate" value="{{ endperiod }}">
                                        <span class="glyphicon glyphicon-ok" aria-hidden="true" onclick="setPeriod('custom'); loadShowProjet({{ projet.id }});"></span>
                                    <li{% if period == 'all' or period == '' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('all'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'all' or period == '' %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Toutes les dates
                                        </a></li>
                                    <li role="separator" class="divider"></li>
                                    <li{% if period == 'today' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('today'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'today'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Aujourd'hui
                                        </a></li>
                                    <li role="separator" class="divider"></li>
                                    <li{% if period == 'thisweek' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('thisweek'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'thisweek'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Cette semaine
                                        </a></li>
                                    <li{% if period == 'thismonth' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('thismonth'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'thismonth'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Ce mois
                                        </a></li>
                                    <li{% if period == 'thisyear' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('thisyear'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'thisyear'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Cette année
                                        </a></li>
                                    <li role="separator" class="divider"></li>
                                    <li{% if period == 'nextweek' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('nextweek'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'nextweek'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Semaine prochaine
                                        </a></li>
                                    <li{% if period == 'nextmonth' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('nextmonth'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'nextmonth'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Mois prochain
                                        </a></li>
                                    <li role="separator" class="divider"></li>
                                    <li{% if period == 'lastweek' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('lastweek'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'lastweek'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Semaine dernière
                                        </a></li>
                                    <li{% if period == 'lastmonth' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('lastmonth'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'lastmonth'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Mois dernier
                                        </a></li>
                                    <li{% if period == 'lastyear' %} class="active"{% endif %}>
                                        <a onclick="setPeriod('lastyear'); loadShowProjet({{ projet.id }});">
                                            {% if period == 'lastyear'  %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Année dernière
                                        </a></li>
                                </ul>
                            </div>
                            <div class="dropdown pull-right">
                                {% if sort == 'echeance' or sort == '' %}{% set sorttext = 'Par Prochaine Echéance' %}{% endif %}
                                {% if sort == 'datecreation' %}{% set sorttext = 'Par Date de Création' %}{% endif %}
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{ sorttext }} <span class="glyphicon glyphicon-menu-down"></span></a>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li{% if sort == 'echeance' or sort == '' %} class="active"{% endif %}>
                                        <a onclick="setSort('echeance'); loadShowProjet({{ projet.id }});">
                                            {% if sort == 'echeance' or sort == '' %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Par Prochaine Echéance
                                        </a></li>
                                    <li{% if sort == 'datecreation' %} class="active"{% endif %}>
                                        <a onclick="setSort('datecreation'); loadShowProjet({{ projet.id }});">
                                            {% if sort == 'datecreation' %}<span class="glyphicon glyphicon-ok"></span>{% endif %}&nbsp;&nbsp;Par Date de Création
                                        </a></li>
                                </ul>
                            </div>
                            <span class="pull-right sortorder" onclick="
                                  {% if sortorder == 'ASC' %}setSortOrder('DESC');{% else %}setSortOrder('ASC');{% endif %} loadShowProjet({{ projet.id }});
                                  ">
                                {% if sortorder == 'ASC' %}<span class="glyphicon glyphicon-arrow-up"></span>{% endif %}
                                {% if sortorder == 'DESC' %}<span class="glyphicon glyphicon-arrow-down"></span>{% endif %}
                            </span>
                        </div>
                        <div class="col-md-1 col-sm-12 col-xs-12">
                            <div class="input-group pull-right">
                                <span class="input-group-addon view-bloc">
                                    <span class="glyphicon glyphicon-th" aria-hidden="true"></span>
                                </span>
                                <span class="input-group-addon view-list">
                                    <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>
                                </span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
                    
        <div class="row">
            <div class="col-md-12">
                <div class="details-select-bar hidden">
                    <span class="pull-left elements-selected"></span>
                    <a class="pull-left unckecked-all" onclick="uncheckAll();">tout désélectionner</a>
                    <button class="btn btn-danger pull-right delete-selected" onclick="{% if type == 'tache'%}deleteSelectedTache(){% elseif type == 'appel'%}deleteSelectedAppel(){% elseif type == 'facture'%}deleteSelectedFacture(){% elseif type == 'encaissement'%}deleteSelectedEncaissement(){% elseif type == 'avoir'%}deleteSelectedAvoir(){% endif %};">Supprimer</button>
                    <a class="pull-right cancel-select" onclick="uncheckAll();">Annuler</a>
                </div>
            </div>
        </div>
                    
        <div class="row">
            {% if type == 'all' or type == 'tache' %}
                {% for tache in taches %}
                    <div class="col-md-4 col-sm-12 col-xs-12 bloc-view tache-bloc-view mt-25">
                        <div class="bloc">
                            <div class="bloc-content">
                                <span class="bloc-title"><a onclick="loadEditTache({{ tache.id }});">{{ tache.sujet|length > 24 ? tache.sujet|slice(0, 24) ~ '...' : tache.sujet }}</a></span>
                                <span class="bloc-created pull-right">{{ tache.creeLe|date('d/m/Y') }}</span>
                                {% if tache.oneClientProspect %}
                                <span class="bloc-projet">
                                    {{ tache.oneClientProspect.nomVisible }} {% if tache.oneContactClient %}{% if tache.oneContactClient.prenom != '' %}{{ tache.oneContactClient.prenom ~' ' }}{% endif %}{{ tache.oneContactClient.nom }}{% endif %}
                                </span>
                                {% endif %}
                                {% if tache.opportunite %}
                                <span class="bloc-opportunite">{{ tache.opportunite.nom }}</span>
                                {% endif %}

                                {% if tache.status == 0 %}
                                    {% set now = date('now'|date('Y/m/d')) %}
                                    {% set echeance = date(tache.echeance|date('Y/m/d')) %}
                                    {% set difference = echeance.diff(now) %}
                                    {% set leftdays = difference.days %}

                                    {% if leftdays == 0 %}
                                        {% set classname = "todo" %}
                                        {% set text = "Aujourd'hui" %}
                                    {% elseif leftdays == 1 and echeance > now %}
                                        {% set classname = "todo" %}
                                        {% set text = "Dans 1 jour" %}
                                    {% elseif leftdays == 1 and echeance < now %}
                                        {% set classname = "overdue" %}
                                        {% set text = "1 jour de retard" %}
                                    {% elseif leftdays > 1 and echeance > now %}
                                        {% set classname = "todo" %}
                                        {% set text = "Dans "~leftdays~" jours" %}
                                    {% elseif leftdays > 1 and echeance < now %}
                                        {% set classname = "overdue" %}
                                        {% set text = ""~leftdays~" jours de retard" %}
                                    {% endif %}
                                {% else %}
                                    {% set classname = "done" %}
                                    {% set text = "Fait - "~tache.modifieLe|date('d/m/Y') %}
                                {% endif %}
                                <span class="bloc-status {{ classname }}">{{ text }}</span>
                            </div>
                            <div class="bloc-footer">
                                <div class="dropdown">
                                    <span class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                    </span>
                                    <div class="clear-fix"></div>
                                    <ul class="dropdown-menu dropdown-menu-right pull-right">
                                        <li class="remove-action">
                                            <a onclick="deleteTache({{ tache.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                
                {% if type == 'tache' %}
                <div class="col-md-12 list-view tache-list-view mt-25">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="checkall" onchange="toggleAll();" /></th>
                                <th>Titre</th>
                                <th>Client/Prospect</th>
                                <th>Opportunité</th>
                                <th>Temps</th>
                                <th>Note</th>
                                <th>Date de Création</th>
                                <th>Fait sur</th>
                                <th>Prochaine Echéance</th>
                                <th>Statut</th>
                                <th class="action"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tache in taches %}
                            <tr>
                                <td><input type="checkbox" class="element" value="{{ tache.id }}" onchange="toggleThis();" /></td>
                                <td><a onclick="loadEditTache({{ tache.id }});">{{ tache.sujet }}</a></td>
                                <td>{% if tache.oneClientProspect %}{{ tache.oneClientProspect.nomVisible }}{% endif %}</td>
                                <td>{% if tache.oneContactClient %}{% if tache.oneContactClient.prenom != '' %}{{ tache.oneContactClient.prenom ~' ' }}{% endif %}{{ tache.oneContactClient.nom }}{% endif %}</td>
                                <td></td>
                                <td>{{ tache.memo }}</td>
                                <td>{{ tache.creeLe|date('d/m/Y') }}</td>
                                <td></td>
                                <td>{{ tache.echeance|date('d/m/Y') }}</td>
                                <td>
                                    {% if tache.status == 0 %}
                                        {% set now = date('now'|date('Y/m/d')) %}
                                        {% set echeance = date(tache.echeance|date('Y/m/d')) %}
                                        {% set difference = echeance.diff(now) %}
                                        {% set leftdays = difference.days %}
                                        {% if leftdays == 0 %}
                                            <span class="todo">Aujourd'hui</span>
                                        {% elseif leftdays == 1 and echeance > now %}
                                            <span class="todo">Dans 1 jour</span>
                                        {% elseif leftdays == 1 and echeance < now %}
                                            <span class="overdue">1 jour de retard</span>
                                        {% elseif leftdays > 1 and echeance > now %}
                                            <span class="todo">Dans {{ leftdays }} jours</span>
                                        {% elseif leftdays > 1 and echeance < now %}
                                            <span class="overdue">{{ leftdays }} jours de retard</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="done">Fait</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <span class="action" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                        </span>
                                        <ul class="dropdown-menu dropdown-menu-right pull-right">
                                            <li class="remove-action">
                                                <a onclick="deleteTache({{ tache.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            {% endif %}
            
            {% if type == 'all' or type == 'appel' %}
                {% for appel in appels %}
                    <div class="col-md-4 col-sm-12 col-xs-12 bloc-view appel-bloc-view mt-25">
                        <div class="bloc">
                            <div class="bloc-content">
                                <span class="bloc-title"><a onclick="loadEditAppel({{ appel.id }});">{{ appel.sujet|length > 24 ? appel.sujet|slice(0, 24) ~ '...' : appel.sujet }}</a></span>
                                <span class="bloc-created pull-right">{{ appel.creeLe|date('d/m/Y') }}</span>
                                {% if appel.oneClientProspect %}
                                <span class="bloc-projet">
                                    {{ appel.oneClientProspect.nomVisible }} {% if appel.oneContactClient %}{% if appel.oneContactClient.prenom != '' %}{{ appel.oneContactClient.prenom ~' ' }}{% endif %}{{ appel.oneContactClient.nom }}{% endif %}
                                </span>
                                {% endif %}
                                {% if appel.opportunite %}
                                <span class="bloc-opportunite">{{ appel.opportunite.nom }}</span>
                                {% endif %}

                                {% if appel.status == 0 %}
                                    {% set now = date('now'|date('Y/m/d')) %}
                                    {% set echeance = date(appel.echeance|date('Y/m/d')) %}
                                    {% set difference = echeance.diff(now) %}
                                    {% set leftdays = difference.days %}

                                    {% if leftdays == 0 %}
                                        {% set classname = "todo" %}
                                        {% set text = "Aujourd'hui" %}
                                    {% elseif leftdays == 1 and echeance > now %}
                                        {% set classname = "todo" %}
                                        {% set text = "Dans 1 jour" %}
                                    {% elseif leftdays == 1 and echeance < now %}
                                        {% set classname = "overdue" %}
                                        {% set text = "1 jour de retard" %}
                                    {% elseif leftdays > 1 and echeance > now %}
                                        {% set classname = "todo" %}
                                        {% set text = "Dans "~leftdays~" jours" %}
                                    {% elseif leftdays > 1 and echeance < now %}
                                        {% set classname = "overdue" %}
                                        {% set text = ""~leftdays~" jours de retard" %}
                                    {% endif %}
                                {% else %}
                                    {% set classname = "done" %}
                                    {% set text = "Fait - "~appel.modifieLe|date('d/m/Y') %}
                                {% endif %}
                                <span class="bloc-status {{ classname }}">{{ text }}</span>
                            </div>
                            <div class="bloc-footer">
                                <div class="dropdown">
                                    <span class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                    </span>
                                    <div class="clear-fix"></div>
                                    <ul class="dropdown-menu dropdown-menu-right pull-right">
                                        <li class="remove-action">
                                            <a onclick="deleteAppel({{ appel.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                
                {% if type == 'appel' %}
                <div class="col-md-12 list-view appel-list-view mt-25">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="checkall" onchange="toggleAll();" /></th>
                                <th>Titre</th>
                                <th>Client/Prospect</th>
                                <th>Note</th>
                                <th>Date de Création</th>
                                <th>Prochaine Echéance</th>
                                <th>Statut</th>
                                <th class="action"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appel in appels %}
                            <tr>
                                <td><input type="checkbox" class="element" value="{{ appel.id }}" onchange="toggleThis();" /></td>
                                <td><a onclick="loadEditAppel({{ appel.id }});">{{ appel.sujet|length > 24 ? appel.sujet|slice(0, 24) ~ '...' : appel.sujet }}</a></td>
                                <td>{% if appel.oneClientProspect %}{{ appel.oneClientProspect.nomVisible }}{% endif %}</td>
                                <td>{{ appel.note }}</td>
                                <td>{{ appel.creeLe|date('d/m/Y') }}</td>
                                <td>{{ appel.echeance|date('d/m/Y') }}</td>
                                <td>
                                    {% if appel.status == 0 %}
                                        {% set now = date('now'|date('Y/m/d')) %}
                                        {% set echeance = date(appel.echeance|date('Y/m/d')) %}
                                        {% set difference = echeance.diff(now) %}
                                        {% set leftdays = difference.days %}
                                        {% if leftdays == 0 %}
                                            <span class="todo">Aujourd'hui</span>
                                        {% elseif leftdays == 1 and echeance > now %}
                                            <span class="todo">Dans 1 jour</span>
                                        {% elseif leftdays == 1 and echeance < now %}
                                            <span class="overdue">1 jour de retard</span>
                                        {% elseif leftdays > 1 and echeance > now %}
                                            <span class="todo">Dans {{ leftdays }} jours</span>
                                        {% elseif leftdays > 1 and echeance < now %}
                                            <span class="overdue">{{ leftdays }} jours de retard</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="done">Fait</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <span class="action" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                        </span>
                                        <ul class="dropdown-menu dropdown-menu-right pull-right">
                                            <li class="remove-action">
                                                <a onclick="deleteAppel({{ appel.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            {% endif %}
            
            {% if type == 'all' or type == 'facture' %}
                {% for facture in factures %}
                    <div class="col-md-4 col-sm-12 col-xs-12 bloc-view opportunite-bloc-view mt-25">
                        <div class="bloc">
                            <div class="bloc-content">
                                <p class="bloc-title"><a onclick="loadEditFacture({{ facture.id }});">Facture {{ facture.code }}</a></p>
                                <p class="bloc-date">{{ facture.dateFacture|date('d/m/y') }}</p>
                                <p class="bloc-client">{{ facture.oneClientProspect.nomVisible }}</p>
                                <p class="bloc-rest">
                                    <span class="status {% if facture.statusFacture == 0 %}todo{% elseif facture.statusFacture == 1 %}won{% endif %}">
                                        {% if facture.statusFacture == 0 %}
                                            {% set now = date('now'|date('Y/m/d')) %}
                                            {% set echeance = date(facture.dateFacture|date('Y/m/d')) %}
                                            {% set difference = echeance.diff(now) %}
                                            {% set leftdays = difference.days %}
                                            {% if leftdays == 0 %}Aujourd'hui
                                            {% elseif leftdays == 1 and echeance > now %}Dans 1 jour
                                            {% elseif leftdays == 1 and echeance < now %}1 jour de retard
                                            {% elseif leftdays > 1 and echeance > now %}Dans {{ leftdays }} jours
                                            {% elseif leftdays > 1 and echeance < now %}{{ leftdays }} jours de retard
                                            {% endif %}
                                        {% endif %}
                                        {% if facture.statusFacture == 1 %}Payée{% endif %}
                                    </span>
                                    <span class="bill"></span>
                                    <span class="amount">{{ factureAmounts[facture.id]|number_format(0, '.', ' ') ~' '~params.comptableDevise.symbole }}</span>
                                </p>
                                <div class="clearfix"></div>
                            </div>
                            <div class="bloc-footer">
                                <div class="dropdown">
                                    <span class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                    </span>
                                    <div class="clear-fix"></div>
                                    <ul class="dropdown-menu dropdown-menu-right pull-right">
                                        <li class="remove-action">
                                            <a onclick="deleteFacture({{ facture.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            
                {% if type == 'facture' %}
                <div class="col-md-12 list-view opportunite-list-view mt-25">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="checkall" onchange="toggleAll();" /></th>
                                <th>Date de la Facture</th>
                                <th>Facture</th>
                                <th>Client/Prospect</th>
                                <th>Montant</th>
                                <th>Reste à payer</th>
                                <th>Note</th>
                                <th>Prochaine Echéance</th>
                                <th>Statut</th>
                                <th class="action"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for facture in factures %}
                            <tr>
                                <td><input type="checkbox" class="element" value="{{ facture.id }}" onchange="toggleThis();" /></td>
                                <td>{{ facture.dateFacture|date('d/m/y') }}</td>
                                <td><a onclick="loadEditFacture({{ facture.id }});">{{ facture.code }}</a></td>
                                <td>{{ facture.oneClientProspect.nomVisible }}</td>
                                <td>{{ factureAmounts[facture.id]|number_format(0, '.', ' ') ~' '~params.comptableDevise.symbole }}</td>
                                <td></td>
                                <td>{% if facture.note != '' %}
                                    <span class="glyphicon glyphicon-info-sign facture-note" aria-hidden="true" data-toggle="popover" data-placement="left" data-trigger="click" data-html="true" data-content="{{ facture.note }}"></span>
                                    {% endif %}
                                </td>
                                <td></td>
                                <td>
                                    <span class="status {% if facture.statusFacture == 0 %}todo{% elseif facture.statusFacture == 1 %}won{% endif %}">
                                        {% if facture.statusFacture == 0 %}
                                            {% set now = date('now'|date('Y/m/d')) %}
                                            {% set echeance = date(facture.dateFacture|date('Y/m/d')) %}
                                            {% set difference = echeance.diff(now) %}
                                            {% set leftdays = difference.days %}
                                            {% if leftdays == 0 %}Aujourd'hui
                                            {% elseif leftdays == 1 and echeance > now %}Dans 1 jour
                                            {% elseif leftdays == 1 and echeance < now %}1 jour de retard
                                            {% elseif leftdays > 1 and echeance > now %}Dans {{ leftdays }} jours
                                            {% elseif leftdays > 1 and echeance < now %}{{ leftdays }} jours de retard
                                            {% endif %}
                                        {% endif %}
                                        {% if facture.statusFacture == 1 %}Payée{% endif %}
                                    </span>
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <span class="action" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                        </span>
                                        <ul class="dropdown-menu dropdown-menu-right pull-right">
                                            <li class="remove-action">
                                                <a onclick="deleteFacture({{ facture.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            {% endif %}
            
            {% if type == 'all' or type == 'encaissement' %}
                {% for encaissement in encaissements %}
                    <div class="col-md-4 col-sm-12 col-xs-12 bloc-view encaissement-bloc-view mt-25">
                        <div class="bloc">
                            <div class="bloc-content">
                                <p class="bloc-title"><a onclick="loadEditEncaissement({{ encaissement.id }});">{{ encaissement.code }}</a></p>
                                <p class="bloc-subtitle">{{ encaissement.oneTypeEncaissement.nom }}</p>
                                <p class="bloc-date">{{ encaissement.dateEncaissement|date('d/m/y') }}</p>
                                <p class="bloc-client">{{ encaissement.oneClientProspect.nomVisible }}</p>
                                <p class="bloc-rest">
                                    <span class="bill"></span>
                                    <span class="amount">{{ encaissementAmounts[encaissement.id]|number_format(0, '.', ' ') ~' '~params.comptableDevise.symbole }}</span>
                                </p>
                                <div class="clearfix"></div>
                            </div>
                            <div class="bloc-footer">
                                <div class="dropdown">
                                    <span class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                    </span>
                                    <div class="clear-fix"></div>
                                    <ul class="dropdown-menu dropdown-menu-right pull-right">
                                        <li class="remove-action">
                                            <a onclick="deleteEncaissement({{ encaissement.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            
                {% if type == 'encaissement' %}
                <div class="col-md-12 list-view encaissement-list-view mt-25">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="checkall" onchange="toggleAll();" /></th>
                                <th>Date de réception</th>
                                <th>Encaissement de Vente</th>
                                <th>Client/Prospect</th>
                                <th>Type</th>
                                <th>Statut</th>
                                <th>Montant</th>
                                <th>Note</th>
                                <th class="action"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for encaissement in encaissements %}
                            <tr>
                                <td><input type="checkbox" class="element" value="{{ encaissement.id }}" onchange="toggleThis();" /></td>
                                <td>{{ encaissement.dateEncaissement|date('d/m/y') }}</td>
                                <td><a onclick="loadEditEncaissement({{ encaissement.id }});">{{ encaissement.code }}</a></td>
                                <td>{{ encaissement.oneClientProspect.nomVisible }}</td>
                                <td>{{ encaissement.oneTypeEncaissement.nom }}</td>
                                <td></td>
                                <td>{{ encaissementAmounts[encaissement.id]|number_format(0, '.', ' ') ~' '~params.comptableDevise.symbole }}</td>
                                <td>{% if encaissement.note != '' %}
                                    <span class="glyphicon glyphicon-info-sign encaissement-note" aria-hidden="true" data-toggle="popover" data-placement="left" data-trigger="click" data-html="true" data-content="{{ encaissement.note }}"></span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <span class="action" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                        </span>
                                        <ul class="dropdown-menu dropdown-menu-right pull-right">
                                            <li class="remove-action">
                                                <a onclick="deleteEncaissement({{ encaissement.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            {% endif %}
            
            {% if type == 'all' or type == 'avoir' %}
                {% for avoir in avoirs %}
                    <div class="col-md-4 col-sm-12 col-xs-12 bloc-view avoir-bloc-view mt-25">
                        <div class="bloc">
                            <div class="bloc-content">
                                <p class="bloc-title"><a onclick="loadEditAvoir({{ avoir.id }});">Avoir {{ avoir.code }}</a></p>
                                <p class="bloc-date">{{ avoir.dateFacture|date('d/m/y') }}</p>
                                <p class="bloc-client">{{ avoir.oneClientProspect.nomVisible }}</p>
                                <p class="bloc-rest">
                                    <span class="status {% if avoir.statusFacture == 0 %}todo{% elseif avoir.statusFacture == 1 %}won{% endif %}">
                                        {% if avoir.statusFacture == 0 %}A payer{% endif %}
                                        {% if avoir.statusFacture == 1 %}Payée{% endif %}
                                    </span>
                                    <span class="bill"></span>
                                    <span class="amount">{{ avoirAmounts[avoir.id]|number_format(0, '.', ' ') ~' '~params.comptableDevise.symbole }}</span>
                                </p>
                                <div class="clearfix"></div>
                            </div>
                            <div class="bloc-footer">
                                <div class="dropdown">
                                    <span class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                    </span>
                                    <div class="clear-fix"></div>
                                    <ul class="dropdown-menu dropdown-menu-right pull-right">
                                        <li class="remove-action">
                                            <a onclick="deleteAvoir({{ avoir.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            
                {% if type == 'avoir' %}
                <div class="col-md-12 list-view avoir-list-view mt-25">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="checkall" onchange="toggleAll();" /></th>
                                <th>Date de l'Avoir</th>
                                <th>Avoir</th>
                                <th>Client/Prospect</th>
                                <th>Montant</th>
                                <th>Reste à payer</th>
                                <th>Note</th>
                                <th>Prochaine Echéance</th>
                                <th>Statut</th>
                                <th class="action"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for avoir in avoirs %}
                            <tr>
                                <td><input type="checkbox" class="element" value="{{ avoir.id }}" onchange="toggleThis();" /></td>
                                <td>{{ avoir.dateFacture|date('d/m/y') }}</td>
                                <td><a onclick="loadEditAvoir({{ avoir.id }});">{{ avoir.code }}</a></td>
                                <td>{{ avoir.oneClientProspect.nomVisible }}</td>
                                <td>{{ avoirAmounts[avoir.id]|number_format(0, '.', ' ') ~' '~params.comptableDevise.symbole }}</td>
                                <td></td>
                                <td>{% if avoir.note != '' %}
                                    <span class="glyphicon glyphicon-info-sign avoir-note" aria-hidden="true" data-toggle="popover" data-placement="left" data-trigger="click" data-html="true" data-content="{{ avoir.note }}"></span>
                                    {% endif %}
                                </td>
                                <td></td>
                                <td>
                                    <span class="status {% if avoir.statusFacture == 0 %}todo{% elseif avoir.statusFacture == 1 %}won{% endif %}">
                                        {% if avoir.statusFacture == 0 %}A payer{% endif %}
                                        {% if avoir.statusFacture == 1 %}Payée{% endif %}
                                    </span>
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <span class="action" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <class class="glyphicon glyphicon-option-vertical" aria-hidden="true"></class>
                                        </span>
                                        <ul class="dropdown-menu dropdown-menu-right pull-right">
                                            <li class="remove-action">
                                                <a onclick="deleteAvoir({{ avoir.id }});"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;Supprimer</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>